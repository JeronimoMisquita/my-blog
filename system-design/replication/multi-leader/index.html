<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Jeronimo Misquita's Personal Website and Software Engineering blog">
      
      
      
        <link rel="canonical" href="https://JeronimoMisquita.github.io/system-design/replication/multi-leader/">
      
      
        <link rel="prev" href="../single-leader/">
      
      
        <link rel="next" href="../leaderless/">
      
      
        
      
      
      <link rel="icon" href="../../../images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Multi Leader - Jeronimo Misquita</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#multi-leader" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Jeronimo Misquita" class="md-header__button md-logo" aria-label="Jeronimo Misquita" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Jeronimo Misquita
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Multi Leader
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  About Me

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../overview/" class="md-tabs__link">
          
  
  
  System Design

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../books/readings/" class="md-tabs__link">
          
  
  
  Book Shelf

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../projects/pdf-utilities/" class="md-tabs__link">
          
  
  
  Projects

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../blog/" class="md-tabs__link">
        
  
  
    
  
  Blog

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../health/groceries/" class="md-tabs__link">
          
  
  
  Health

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Jeronimo Misquita" class="md-nav__button md-logo" aria-label="Jeronimo Misquita" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    Jeronimo Misquita
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About Me
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    System Design
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    System Design
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Replication
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Replication
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-leader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Single Leader
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Multi Leader
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi Leader
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-datacenter-operation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi datacenter operation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-leader-usecases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi Leader Usecases
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multi Leader Usecases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clients-with-offline-operation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Clients with offline operation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collaborative-editing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Collaborative editing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-write-conflicts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handling Write conflicts
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Handling Write conflicts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conflict-avoidance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conflict avoidance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#converging-towards-a-consistent-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Converging towards a consistent state
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-leader-replication-topologies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-leader replication topologies
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../leaderless/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Leaderless
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2">
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Partitioning
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Partitioning
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../partitioning/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../partitioning/how-to-partition-data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How to Partition a Dataset
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Book Shelf
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Book Shelf
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/readings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Books I've read
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4">
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Projects
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Projects
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../projects/pdf-utilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pdf utilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6">
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Health
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Health
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../health/groceries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ðŸ›’ My Weekly Shopping List
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-datacenter-operation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi datacenter operation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-leader-usecases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi Leader Usecases
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multi Leader Usecases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clients-with-offline-operation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Clients with offline operation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collaborative-editing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Collaborative editing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-write-conflicts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handling Write conflicts
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Handling Write conflicts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conflict-avoidance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conflict avoidance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#converging-towards-a-consistent-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Converging towards a consistent state
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-leader-replication-topologies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-leader replication topologies
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="multi-leader">Multi Leader</h1>
<h2 id="overview">Overview</h2>
<p>Single leader replication has the drawback that only one node accepts writes. If that node is not reachable no writes are possible.</p>
<p>Multi-leader replication is a logical extension to this idea where more than one node in the cluster accepts writes.
Each leader replicates changes to all other nodes. Therefore, a leader node simultaneously also acts as a replica for other leader nodes.</p>
<h2 id="multi-datacenter-operation">Multi datacenter operation</h2>
<ul>
<li>Unique flavour of multi-leader replication</li>
<li>Each data center has a leader and followers.</li>
<li>The leader shares updates with its local followers. The leader also replicates updates <strong>async</strong> to leaders in other datacenters.</li>
<li>Leaders are responsible for conflict resolution when updates from other leaders conflict with its data representation.</li>
</ul>
<p><strong>Advantages:</strong></p>
<ul>
<li>The system operates even if one datacenter fails. Both writes and reads are processed.</li>
<li>Lower latency on the write path as it is processed by the leader in the geographically closest datacenter. Most latency comes from the request travelling over the public low-trust internet.</li>
</ul>
<p>Some databases support multi-leader mode by default. But for most others, external tools are needed e.g. BDR for Postgres, Tungsten Replicator for MySQL, and Golden Gate for Oracle.</p>
<p><strong>Disadvantages:</strong></p>
<ul>
<li>Leaders need a conflict resolution process.</li>
<li>In many databases, multi-leader operation is a retrofitted feature and there can be surprising interactions with other database features like auto-incrementing keys, triggers, and constraints.</li>
</ul>
<blockquote>
<p><strong>NOTE:</strong> Usually multi-leader operation is avoided if possible.</p>
</blockquote>
<h2 id="multi-leader-usecases">Multi Leader Usecases</h2>
<h3 id="clients-with-offline-operation">Clients with offline operation</h3>
<ul>
<li>A use case for multi-leader replication is when the application needs to continue to work when it's disconnected from the internet.</li>
<li>e.g. a calendar app on your phone. You need to be able to see your meetings (read requests) and enter new meetings (write requests) at any time even without an internet connection. The changes are synced when your device comes back online.</li>
<li>This use case is like multi-datacenter operation where each device is like a datacenter and the connection between them is extremely unreliable.</li>
</ul>
<p>CouchDB is a document style NoSQL DB specializing in this mode of operation.</p>
<h3 id="collaborative-editing">Collaborative editing</h3>
<ul>
<li>In collaborative editing (Google Docs), multiple users can edit the same document at the same time.</li>
<li>Under the hood, user changes are committed to their local leader. Then they are async replicated to a central server and onwards to other users.</li>
<li>A conflict resolution process is important when clashes occur (discussed later).</li>
<li>In such editors, the unit of change is usually very small like a single key stroke.</li>
</ul>
<p>If this approach was not employed, a user would have to lock the whole document for editing and other users would have to wait when it was locked.</p>
<h2 id="handling-write-conflicts">Handling Write conflicts</h2>
<p>Since leaders accept writes to their local instances, any conflicts are detected only much later when changes are async replicated. It may be days after the user actually received a "saved" confirm message.</p>
<p>This does not happen in single-leader systems. Here, the second write is either blocked, waits for the first one to complete, or fails with an error. The user is forced to retry the second write on top of the first one.</p>
<h3 id="conflict-avoidance">Conflict avoidance</h3>
<p>If there are resources that could be overwritten, we could design the system to ensure they are handled by the same leader. For example, a user can be assigned to a single datacenter (closest to him), and reads and writes for that user are handled by the same datacenter, so conflict is avoided across leaders. Other users may be assigned different home datacenters. This strategy avoids concurrent writes across different leaders.</p>
<h3 id="converging-towards-a-consistent-state">Converging towards a consistent state</h3>
<p>In a single leader system, if multiple writes are made to a record, the last write reflects the record state.</p>
<p>In a multi-leader system, in general, there is no such ordering of writes. If replicas simply applied writes in the order they were received, different replicas may end up with a different final state (depending on the replication propagation lag of various write requests from different leaders).
There must be a way that all replicas arrive at the same final value once all changes are replicated.</p>
<p><strong>Strategies for achieving convergent conflict resolution:</strong></p>
<ol>
<li>Give each write a timestamp. Last timestamp wins, and other older write changes are discarded. - Strategy is prone to data loss (due to non-synced clocks on various nodes).</li>
<li>Give each write a unique ID. ID is derived from the node id. During conflict, the highest ID wins (a write at a higher-numbered replica always takes precedence over writes that originated at a lower-numbered replica). The strategy is also prone to data loss.</li>
<li>Somehow merge the values together. e.g. if there is a conflict in writing the title of a doc. Simply append all the possible conflicting titles together, e.g. <code>titleA/titleB</code>.</li>
<li>Record the conflict in an explicit data structure that preserves all the information and write application code that resolves the conflict at some later time (perhaps by prompting the user).</li>
</ol>
<p>Conflicts handled via application code can be resolved in 2 ways:</p>
<ol>
<li><strong>On Write</strong> - As soon as the system detects a conflict in the log of replicated changes it calls a conflict resolution handler (Bucardo in Postgres allows you to write a Perl script for this purpose). The handler cannot prompt the user. It runs as a background process and must resolve the conflict quickly.</li>
<li><strong>On Read</strong> - Details about the conflict are stored in a data structure. The structure is returned when the record is read by an application. The application will prompt the user to manually resolve the conflict and write the final result back to the DB. CouchDB works this way.</li>
</ol>
<p>Conflict resolution applies at the level of the record (row) or document (NoSQL DB), not the transaction level. I.e. if a transaction causes multiple writes, each write is a separate conflict that is resolved independently.</p>
<p>Some research is ongoing for automatically resolving conflicts.</p>
<ul>
<li><strong>Conflict-free replicated datatypes (CRDTs)</strong> - Family of data structures for sets, maps, ordered lists, counters etc. that can be concurrently edited by multiple users and automatically resolve conflict in sensible ways.</li>
<li><strong>Mergeable persistent data structures</strong> - track history explicitly similar to Git version control and use some merge functions.</li>
<li><strong>Operational transformation</strong> - designed for concurrently editing an ordered list of items such as a list of characters that constitute a text document (used in Google Docs).</li>
</ul>
<h2 id="multi-leader-replication-topologies">Multi-leader replication topologies</h2>
<p>If more than one leader node exists, then replication between leaders can be organized as topologies:</p>
<ol>
<li><strong>Circular</strong> - Each leader receives writes from <ins>one</ins> other leader and forwards those writes <ins>along with any of its own</ins> to the next leader in the circular chain.</li>
<li><strong>All to All</strong> - Every leader forwards writes to every other leader.</li>
</ol>
<p>To prevent infinite looping in (1), each node is given an identifier and replicated writes are tagged with all node IDs that they passed through. A node that sees its own ID then discards the replicated write as it applied it earlier.</p>
<p>In (2) Each leader first accepts writes and saves to local disk (it can have 1 or few sync replicas in local datacenter). It then forwards to other leaders as well as other local datacenter dedicated followers the replicated changes in async mode. Network latency inside datacenter is very low so distribution inside datacenter is handled by that datacenter leader.</p>
<p><strong>Disadvantage of (1)</strong> If a node goes down in the chain, end-to-end replication stops until the faulty node is repaired. Technically, the topology can also be reconfigured to work around the fault node but it usually is a manual process.</p>
<p><strong>Disadvantage of (2):</strong> Replication paths may have different latency. Writes may appear in a random order. E.g. an update statement may appear before the insert statement it relied on.
The problem is similar to the earlier problem of "Consistent prefix reads". To order these writes correctly a technique called <strong>version vectors</strong> is used.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "toc.follow"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>